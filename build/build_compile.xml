<?xml version="1.0" encoding="utf-8"?>
<project name="LightstreamerMQTTJSClient-compile" default="deploy" basedir=".">

  <property name="build_res" location="../build" />

  <tstamp>
    <format property="current.year" pattern="yyyy" />
  </tstamp>

  <target name="compile">
    <copy file="full.build.js" tofile="${rjs_options_dir}/custom.build.js" overwrite="true" />
    <replace file="${rjs_options_dir}/custom.build.js">
      <replacefilter token="source_placeholder" value="${input_dir}" />
      <replacefilter token="built_placeholder" value="${built_dir}" />
      <replacefilter token="input_node_externs_value" value="${input_node_externs}" />
      <replacefilter token="input_externs_value" value="${input_externs}" />
      <replacefilter token="input_logging_externs_value" value="${input_logging_externs}" />
      <replacefilter token="\" value="\\" />
      <replacefilter token="library_placeholder_value" value="${library}" />
      <replacefilter token="version_placeholder_value" value="${version}" />
      <replacefilter token="build_placeholder_value" value="${build}" />
    </replace>

    <java classname="org.mozilla.javascript.tools.shell.Main">
      <arg value="-opt" />
      <arg value="-1" />
      <arg value="r.js" />
      <arg value="-o" />
      <arg value="${rjs_options_dir}/custom.build.js" />
      <classpath>
        <pathelement location="compiler.jar" />
        <pathelement path="js.jar" />
      </classpath>
    </java>

    <input>Check for errors and press ENTER</input>
  </target>

  <target name="deploy" depends="compile">
    <copy file="${built_dir}/LightstreamerMQTT.js" tofile="${output_file}" overwrite="true" verbose="true" />
    <copy file="${built_dir}/LightstreamerMQTT.js.map" tofile="${output_file}.map" overwrite="true" verbose="true" />
    <copy file="${built_dir}/LightstreamerMQTT.js.src.js" tofile="${output_file}.src" overwrite="true" verbose="true" />
  </target>
</project>